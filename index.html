<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–°—Ç–µ–ø–∞: –ö—É—Ä—Å–∫–∏–π –¥–æ–ª–∂–Ω–∏–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --bg-start: #10101b;
            --bg-end: #1c1c2b;
            --primary: #f02d54;
            --secondary: #0f3460;
            --text: #e0e0e0;
            --glass-bg: rgba(40, 40, 60, 0.5);
            --glass-border: rgba(255, 255, 255, 0.1);
            --success: #39d353;
            --danger: #f85149;
            --warning: #ffab00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        html {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(160deg, var(--bg-start) 0%, var(--bg-end) 100%);
            color: var(--text);
            min-height: 100vh;
            min-height: 100dvh; /* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –º–æ–±–∏–ª–æ–∫, —á—Ç–æ–±—ã URL-–±–∞—Ä –Ω–µ –º–µ—à–∞–ª */
            padding: 15px;
            overflow-x: hidden;
            touch-action: manipulation;
            /* –ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ –Ω–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
            font-size: clamp(14px, 3.5vw, 16px); 
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            background: var(--glass-bg);
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        h1 {
            font-size: 1.4rem;
            text-align: center;
            color: var(--primary);
            text-shadow: 0 0 15px var(--primary);
            margin-bottom: 15px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            font-size: 0.85rem;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--text);
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .progress-container { margin-top: 10px; font-size: 0.8rem; }
        .progress-bar { height: 8px; background: rgba(0, 0, 0, 0.3); border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .progress-fill { height: 100%; transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        #stress-bar { background: linear-gradient(90deg, #ffab00, #f85149); }
        #health-bar { background: linear-gradient(90deg, #39d353, #8bc34a); }
        #satiety-bar { background: linear-gradient(90deg, #ffc107, #ffab00); }
        
        .character-container {
            text-align: center;
            margin: 15px 0;
            font-size: 5rem;
            perspective: 500px;
        }
        #stepa-emoji {
            display: inline-block;
            animation: idle-bob 4s ease-in-out infinite;
        }

        /* –ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–µ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .action-btn {
            padding: 10px 5px;
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 80px;
        }
        .action-btn i { font-size: 1.4rem; color: var(--primary); }
        .action-btn:hover { background: rgba(240, 45, 84, 0.2); transform: translateY(-3px); }
        .action-btn:active { transform: translateY(-1px) scale(0.98); background: rgba(240, 45, 84, 0.3); }
        
        .events {
            background: var(--glass-bg); padding: 15px; border-radius: 20px;
            height: 120px; overflow-y: auto; border: 1px solid var(--glass-border); font-size: 0.85rem;
        }
        .event { padding: 8px; margin-bottom: 8px; border-radius: 8px; background: rgba(0, 0, 0, 0.2); border-left: 4px solid var(--secondary); animation: slideIn 0.4s ease-out; }
        .event.danger { border-left-color: var(--danger); }
        .event.success { border-left-color: var(--success); }
        .event.warning { border-left-color: var(--warning); }
        
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px; animation: fadeIn 0.3s ease;
        }
        .modal.show { display: flex; }
        
        .modal-content {
            background: linear-gradient(135deg, var(--bg-end), var(--bg-start)); padding: 25px; border-radius: 20px; max-width: 500px; width: 100%;
            max-height: 85vh; overflow-y: auto; border: 1px solid var(--glass-border); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            animation: scale-up-center 0.4s cubic-bezier(0.390, 0.575, 0.565, 1.000);
        }
        
        .modal-content h3 { color: var(--primary); margin-bottom: 15px; text-align: center; }
        .modal-close { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 12px; cursor: pointer; margin-top: 20px; width: 100%; transition: background 0.2s ease; }
        .modal-close:hover { background: #d83a56; }
        
        .option {
            background: var(--glass-bg); padding: 15px; margin: 10px 0; border-radius: 12px; cursor: pointer; transition: all 0.2s ease; border-left: 4px solid var(--primary);
        }
        .option:hover { background: rgba(233, 69, 96, 0.2); transform: translateX(5px); }
        .option button { background-color: var(--primary); color: white; border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; margin-top: 10px; float: right; }
        .option button.repay { background-color: var(--success); }

        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; align-items: center; gap: 10px; width: 90%; max-width: 400px;}
        .toast { background: var(--glass-bg); backdrop-filter: blur(10px); padding: 12px 18px; border-radius: 12px; color: var(--text); font-size: 0.9rem; border-left: 5px solid var(--primary); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); width: 100%; animation: slideInTop 0.5s ease-out, fadeOut 0.5s ease-in 3.5s forwards; }
        .toast.success { border-left-color: var(--success); } .toast.danger { border-left-color: var(--danger); } .toast.warning { border-left-color: var(--warning); }

        /* --- –ê–Ω–∏–º–∞—Ü–∏–∏ --- */
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes slideInTop { from { opacity: 0; transform: translateY(-50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scale-up-center { from { transform: scale(0.5); opacity: 0.5; } to { transform: scale(1); opacity: 1; } }

        .flash-green { animation: flash-green 0.7s ease; } @keyframes flash-green { 0%, 100% { color: var(--text); transform: scale(1); } 50% { color: var(--success); transform: scale(1.15); } }
        .flash-red { animation: flash-red 0.7s ease; } @keyframes flash-red { 0%, 100% { color: var(--text); transform: scale(1); } 50% { color: var(--danger); transform: scale(1.15); } }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –°—Ç–µ–ø—ã */
        @keyframes idle-bob { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-5px) rotate(2deg); } }
        @keyframes danger-shake { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 10% { transform: translate(-3px, 0) rotate(-2deg); } 20% { transform: translate(3px, 0) rotate(2deg); } 30%, 50%, 70% { transform: translate(-3px, 0) rotate(-2deg); } 40%, 60%, 80% { transform: translate(3px, 0) rotate(2deg); } 90% { transform: translate(0, 0) rotate(0); } }
        @keyframes money-bounce { 0% { transform: scale(1) translateY(0); } 30% { transform: scale(1.2) translateY(-15px) rotate(10deg); } 60% { transform: scale(0.9) translateY(5px); } 100% { transform: scale(1) translateY(0); } }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div class="container">
        <div class="header">
            <h1>üê∑ –°–¢–ï–ü–ê: –ö–£–†–°–ö–ò–ô –î–û–õ–ñ–ù–ò–ö</h1>
            <div class="stats">
                <div class="stat-item">–î–µ–Ω—å<br><span class="stat-value" id="day">1</span></div>
                <div class="stat-item">–î–µ–Ω—å–≥–∏<br><span class="stat-value" id="money">5000 ‚ÇΩ</span></div>
                <div class="stat-item">–î–æ–ª–≥<br><span class="stat-value" id="debt">100 000 ‚ÇΩ</span></div>
                <div class="stat-item">–†–∞–±–æ—Ç–∞<br><span class="stat-value" id="job">–ë–æ–º–∂</span></div>
            </div>
            <div class="progress-container">–ó–¥–æ—Ä–æ–≤—å–µ: <span id="health-value">100</span>/100<div class="progress-bar"><div class="progress-fill" id="health-bar"></div></div></div>
            <div class="progress-container">–°—ã—Ç–æ—Å—Ç—å: <span id="satiety-value">100</span>/100<div class="progress-bar"><div class="progress-fill" id="satiety-bar"></div></div></div>
            <div class="progress-container">–°—Ç—Ä–µ—Å—Å: <span id="stress-value">0</span>/100<div class="progress-bar"><div class="progress-fill" id="stress-bar"></div></div></div>
        </div>
        
        <div class="character-container"><span id="stepa-emoji">üò¥</span></div>
        
        <div class="actions">
            <button class="action-btn" onclick="work()"><i class="fa-solid fa-person-digging"></i><span>–†–∞–±–æ—Ç–∞—Ç—å</span></button>
            <button class="action-btn" onclick="showFoodModal()"><i class="fa-solid fa-burger"></i><span>–ü–æ–∂—Ä–∞—Ç—å</span></button>
            <button class="action-btn" onclick="showFriendsModal()"><i class="fa-solid fa-users"></i><span>–ö–µ–Ω—Ç—ã</span></button>
            <button class="action-btn" onclick="relieveStress()"><i class="fa-solid fa-beer-mug-empty"></i><span>–ß–∏–ª–∏—Ç—å</span></button>
            <button class="action-btn" onclick="payDebt()"><i class="fa-solid fa-hand-holding-dollar"></i><span>–û—Ç–¥–∞—Ç—å –¥–æ–ª–≥</span></button>
            <button class="action-btn" onclick="findJob()"><i class="fa-solid fa-briefcase"></i><span>–ù–∞–π—Ç–∏ —Ä–∞–±–æ—Ç—É</span></button>
        </div>
        
        <div class="events" id="events"></div>
    </div>

    <div id="friends-modal" class="modal"><div class="modal-content"><h3>üë• –ö–µ–Ω—Ç—ã</h3><div id="friends-options"></div><button class="modal-close" onclick="hideModal('friends-modal')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
    <div id="food-modal" class="modal"><div class="modal-content"><h3>üçî –ü–æ–∂—Ä–∞—Ç—å</h3><div id="food-options"></div><button class="modal-close" onclick="hideModal('food-modal')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
    <div id="game-over-modal" class="modal"><div class="modal-content game-over"><h2 id="game-over-title"></h2><p id="game-over-text"></p><button class="modal-close" onclick="restartGame()">–ù–∞—á–∞—Ç—å —ç—Ç—É —Ö—É–π–Ω—é –∑–∞–Ω–æ–≤–æ</button></div></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        let audioContext;
        const soundBuffers = {};
        const soundUrls = {
            click: 'https://www.myinstants.com/media/sounds/mouse-click.mp3',
            gain: 'https://www.myinstants.com/media/sounds/cash-register-cha-ching.mp3',
            gameOver: 'https://www.myinstants.com/media/sounds/sad-violin.mp3',
            notification: 'https://www.myinstants.com/media/sounds/pling-sound-effect.mp3',
            // --- –ù–æ–≤—ã–µ –º–µ–º–Ω—ã–µ –∑–≤—É–∫–∏ ---
            vineBoom: 'https://www.myinstants.com/media/sounds/vine-boom.mp3',
            gtaAhShit: 'https://www.myinstants.com/media/sounds/ah-shit-here-we-go-again.mp3',
            mgsAlert: 'https://www.myinstants.com/media/sounds/metal-gear-solid-alert-sound.mp3',
            mcVillager: 'https://www.myinstants.com/media/sounds/minecraft-villager-sound-effect.mp3',
            nom: 'https://www.myinstants.com/media/sounds/om-nom-nom-nom.mp3'
        };

        async function initAudio() {
            if (audioContext) return;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            for (const key in soundUrls) {
                try {
                    const response = await fetch(soundUrls[key]);
                    const arrayBuffer = await response.arrayBuffer();
                    soundBuffers[key] = await audioContext.decodeAudioData(arrayBuffer);
                } catch (e) { console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–≤—É–∫ ${key}:`, e); }
            }
        }
        
        function playSound(name) {
            if (!audioContext || !soundBuffers[name]) return;
            const source = audioContext.createBufferSource();
            source.buffer = soundBuffers[name];
            source.connect(audioContext.destination);
            source.start(0);
        }

        function haptic(type) {
            try {
                const feedback = tg.HapticFeedback;
                if (type === 'error') feedback.notificationOccurred('error');
                else if (type === 'success') feedback.notificationOccurred('success');
                else if (type === 'warning') feedback.notificationOccurred('warning');
                else if (type === 'light') feedback.impactOccurred('light');
                else feedback.selectionChanged();
            } catch (e) { /* –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω */ }
        }
        
        const initialGameState = {
            day: 1, money: 5000, debt: 100000, health: 100, satiety: 100, stress: 0,
            job: { name: "–ë–æ–º–∂", salary: 750, stress: 5, health: -5, satiety: -15 },
            friends: [
                { name: "–í–∞—Å—è–Ω", desc: "–°—Ç–∞—Ä—ã–π –¥—Ä—É–≥, –Ω–æ —Å–∞–º –≤ –∂–æ–ø–µ", maxLoan: 5000, chance: 0.6, debtAmount: 0 },
                { name: "–ü–µ—Ç—Ä—É—Ö–∞", desc: "–ñ–∞–¥–Ω—ã–π, —Å—á–∏—Ç–∞–µ—Ç –∫–∞–∂–¥—É—é –∫–æ–ø–µ–π–∫—É", maxLoan: 3000, chance: 0.3, debtAmount: 0 },
                { name: "–°–µ–º—ë–Ω—ã—á", desc: "–î—É—à–∞-–ø–∞—Ä–µ–Ω—å, –Ω–æ –ø–æ–¥ –∫–∞–±–ª—É–∫–æ–º", maxLoan: 7000, chance: 0.7, debtAmount: 0 },
                { name: "–ì—Ä–∏—à–∞ –ö–∞–±–∞–Ω", desc: "–ë—Ä–∞—Ç–æ–∫, –¥–∞—Å—Ç –ø–æ–¥ –ø—Ä–æ—Ü–µ–Ω—Ç", maxLoan: 10000, chance: 0.8, debtAmount: 0 }
            ],
            gameOver: false,
        };
        let gameState;

        const food = [
            { name: "–î–æ—à–∏—Ä–∞–∫", cost: 100, satiety: 20, health: -2, stress: 5 },
            { name: "–®–∞—É—Ä–º–∞ —É –ê—à–æ—Ç–∞", cost: 250, satiety: 40, health: 5, stress: 0 },
            { name: "–û–±–µ–¥ –≤ —Å—Ç–æ–ª–æ–≤–∫–µ", cost: 500, satiety: 60, health: 10, stress: -5 },
            { name: "–ü–æ—Å–∏–¥–µ—Ç—å –≤ –∫–∞–±–∞–∫–µ", cost: 2000, satiety: 100, health: 15, stress: -20 }
        ];
        const jobs = [
            { name: "–ì—Ä—É–∑—á–∏–∫", salary: 1500, stress: 15, health: -10, satiety: -20 },
            { name: "–ö—É—Ä—å–µ—Ä", salary: 2000, stress: 10, health: -5, satiety: -25 },
            { name: "–û—Ö—Ä–∞–Ω–Ω–∏–∫", salary: 2500, stress: 5, health: 0, satiety: -10 }
        ];
        const phrases = {
            work: ["–í—ä–µ–±—ã–≤–∞–ª –∫–∞–∫ –ø—Ä–æ–∫–ª—è—Ç—ã–π.", "–ì–æ—Ä–±–∞—Ç–∏–ª—Å—è –∑–∞ –≥—Ä–æ—à–∏.", "–ü—Ä–æ–¥–∞–ª –µ—â–µ –æ–¥–∏–Ω –¥–µ–Ω—å –∂–∏–∑–Ω–∏ –∑–∞ –µ–¥—É."],
            debtThreats: ["üìû –°–µ—Ä—ë–≥–∞: '–°–ª—ã—à—å, —É–µ–±–∞–Ω, –±–∞–±–∫–∏ –≥–¥–µ? –Ø —Ç–≤–æ–π –¥–æ–º —Ç—Ä—É–±–∞ —à–∞—Ç–∞–ª!'", "üìû –°–µ—Ä—ë–≥–∞: '–°—Ç–µ–ø–∞, —è —Ç–≤–æ–∏–º –ª–∏—Ü–æ–º –∞—Å—Ñ–∞–ª—å—Ç —É–¥–æ–±—Ä—è—Ç—å –±—É–¥—É, –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω–µ–≥ –Ω–µ —É–≤–∏–∂—É!'", "SMS: '–¢–≤–æ–∏ –ø–æ—á–∫–∏ —Å—Ç–æ—è—Ç 100–∫. –£ —Ç–µ–±—è –µ—Å—Ç—å –≤—ã–±–æ—Ä.'"],
            friendReject: ["–ø–æ—Å–ª–∞–ª —Ç–µ–±—è –Ω–∞—Ö—É–π.", "—Å–∫–∞–∑–∞–ª, —á—Ç–æ –µ–≥–æ –∂–µ–Ω–∞ –ø—Ä–æ—Ç–∏–≤.", "—Å–¥–µ–ª–∞–ª –≤–∏–¥, —á—Ç–æ –Ω–µ —É–∑–Ω–∞–ª —Ç–µ–±—è."],
            gameOver: {
                health: "–¢—ã —Å–¥–æ—Ö –æ—Ç –∫–∞–∫–æ–π-—Ç–æ —Ö—É–π–Ω–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ —Å–ª–µ–¥–∏–ª –∑–∞ –∑–¥–æ—Ä–æ–≤—å–µ–º. –¢–≤–æ–∏ –¥–æ–ª–≥–∏ –ø–µ—Ä–µ—à–ª–∏ –∫–æ—Ç—É.",
                stress: "–¢–≤–æ—è –∫—É–∫—É—Ö–∞ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ —É–ª–µ—Ç–µ–ª–∞. –û—Å—Ç–∞—Ç–æ–∫ –∂–∏–∑–Ω–∏ —Ç—ã –ø—Ä–æ–≤–µ–¥–µ—à—å, –ø—É—Å–∫–∞—è —Å–ª—é–Ω–∏ –≤ –¥—É—Ä–∫–µ.",
                debt: "–¢–µ—Ä–ø–µ–Ω–∏–µ –°–µ—Ä—ë–≥–∏ –ª–æ–ø–Ω—É–ª–æ. –¢–µ–±—è –≤—ã–≤–µ–∑–ª–∏ –≤ –ª–µ—Å –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ –æ–±—å—è—Å–Ω–∏–ª–∏, —á—Ç–æ —Ç–∞–∫ –¥–µ–ª–∞—Ç—å –Ω–µ–ª—å–∑—è. –¢–≤–æ–∏ –æ—Å—Ç–∞–Ω–∫–∏ –¥–æ —Å–∏—Ö –ø–æ—Ä –∏—â—É—Ç.",
                win: "–ï–±–∞—Ç—å, —Ç—ã —Ä–µ–∞–ª—å–Ω–æ —Å–º–æ–≥! –û—Ç–¥–∞–ª –≤—Å–µ –¥–æ–ª–≥–∏ –∏ –≤—ã–∂–∏–ª –≤ —ç—Ç–æ–º –≥–∞–¥—é—à–Ω–∏–∫–µ. –¢–µ–ø–µ—Ä—å —Ç—ã –ª–µ–≥–µ–Ω–¥–∞ –ö—É—Ä—Å–∫–∞. –ú–æ–∂–µ—à—å —Å—ä–µ–±–∞—Ç—å –æ—Ç—Å—é–¥–∞."
            }
        };

        const ui = {
            day: document.getElementById('day'), money: document.getElementById('money'), debt: document.getElementById('debt'), job: document.getElementById('job'),
            health: document.getElementById('health-value'), healthBar: document.getElementById('health-bar'),
            satiety: document.getElementById('satiety-value'), satietyBar: document.getElementById('satiety-bar'),
            stress: document.getElementById('stress-value'), stressBar: document.getElementById('stress-bar'),
            stepaEmoji: document.getElementById('stepa-emoji'), events: document.getElementById('events'), toastContainer: document.getElementById('toast-container')
        };
        
        function updateUI() {
            animateStatUpdate(ui.day, gameState.day);
            animateStatUpdate(ui.money, gameState.money.toLocaleString('ru-RU') + ' ‚ÇΩ');
            animateStatUpdate(ui.debt, gameState.debt.toLocaleString('ru-RU') + ' ‚ÇΩ');
            animateStatUpdate(ui.job, gameState.job.name);
            
            ui.health.textContent = gameState.health; ui.healthBar.style.width = `${gameState.health}%`;
            ui.satiety.textContent = gameState.satiety; ui.satietyBar.style.width = `${gameState.satiety}%`;
            ui.stress.textContent = gameState.stress; ui.stressBar.style.width = `${gameState.stress}%`;
            updateStepaEmoji();
        }

        let statUpdateTimers = {};
        function animateStatUpdate(element, newValue) {
            const key = element.id; const oldValue = element.textContent;
            if (oldValue !== String(newValue)) {
                const isNumber = !isNaN(parseFloat(oldValue.replace(/ /g, ''))) && !isNaN(parseFloat(String(newValue).replace(/ /g, '')));
                let changeClass = '';
                if (isNumber) {
                    const oldNum = parseFloat(oldValue.replace(/ /g, '')); const newNum = parseFloat(String(newValue).replace(/ /g, ''));
                    if (newNum > oldNum) changeClass = 'flash-green'; if (newNum < oldNum) changeClass = 'flash-red';
                }
                element.textContent = newValue;
                if(changeClass) {
                    clearTimeout(statUpdateTimers[key]); element.classList.remove('flash-green', 'flash-red'); void element.offsetWidth; 
                    element.classList.add(changeClass);
                    statUpdateTimers[key] = setTimeout(() => element.classList.remove(changeClass), 700);
                }
            }
        }

        function changeStat(stat, value) {
            gameState[stat] = Math.max(0, gameState[stat] + value);
            if (['stress', 'health', 'satiety'].includes(stat)) gameState[stat] = Math.min(100, gameState[stat]);
        }
        
        function setStepaAnimation(animation, duration) {
            ui.stepaEmoji.style.animation = 'none'; void ui.stepaEmoji.offsetWidth;
            ui.stepaEmoji.style.animation = `${animation} ${duration}s ease-in-out`;
            setTimeout(() => { ui.stepaEmoji.style.animation = 'idle-bob 4s ease-in-out infinite'; }, duration * 1000);
        }
        
        function updateStepaEmoji() {
            if (gameState.health <= 20) ui.stepaEmoji.textContent = 'üíÄ'; else if (gameState.satiety <= 20) ui.stepaEmoji.textContent = 'ü§¢';
            else if (gameState.stress >= 80) ui.stepaEmoji.textContent = 'üò°'; else if (gameState.money < 1000) ui.stepaEmoji.textContent = 'üò≠';
            else if (gameState.debt > gameState.money * 10) ui.stepaEmoji.textContent = 'üò±'; else ui.stepaEmoji.textContent = 'üòê';
        }

        function addEvent(message, type = "default") {
            const eventEl = document.createElement('div'); eventEl.className = `event ${type}`;
            eventEl.innerHTML = `<b>–î–µ–Ω—å ${gameState.day}:</b> ${message}`; ui.events.prepend(eventEl);
        }

        function showToast(message, type = "default") {
            const toast = document.createElement('div'); toast.className = `toast ${type}`;
            toast.textContent = message; ui.toastContainer.appendChild(toast);
            if(type === 'danger') { haptic('error'); playSound('mgsAlert'); setStepaAnimation('danger-shake', 1.5); }
            else if(type === 'success') { haptic('success'); playSound('notification'); }
            else { haptic('warning'); playSound('notification'); }
            setTimeout(() => toast.remove(), 4000);
        }
        
        function nextDay() {
            if (gameState.gameOver) return; changeStat('day', 1);
            changeStat('satiety', -10);
            if (gameState.satiety <= 0) { changeStat('health', -10); addEvent("–û—Ç –≥–æ–ª–æ–¥–∞ —Å–≤–æ–¥–∏—Ç –∂–∏–≤–æ—Ç. –¢–µ—Ä—è–µ—à—å –∑–¥–æ—Ä–æ–≤—å–µ.", "danger"); }
            if(gameState.stress > 0) changeStat('stress', -2);
            if (Math.random() < 0.25) randomEvent(); if (gameState.day % 5 === 0 && gameState.debt > 0) creditorHarassment();
            updateUI(); checkGameOver(); saveGame();
        }
        
        function work() {
            const { salary, stress, health, satiety } = gameState.job;
            changeStat('money', salary); changeStat('stress', stress); changeStat('health', health); changeStat('satiety', satiety);
            playSound('gain'); haptic('light'); setStepaAnimation('money-bounce', 1);
            addEvent(`${phrases.work[Math.floor(Math.random() * phrases.work.length)]} +${salary} ‚ÇΩ.`);
            nextDay();
        }

        function findJob() {
            if (Math.random() > 0.4) {
                const newJob = jobs[Math.floor(Math.random() * jobs.length)]; gameState.job = newJob;
                showToast(`–¢—ã –Ω–∞—à–µ–ª –Ω–æ–≤—É—é —Ä–∞–±–æ—Ç—É: ${newJob.name}!`, 'success'); addEvent(`–ù–∞–∫–æ–Ω–µ—Ü-—Ç–æ —Ç—ã –Ω–µ –±–æ–º–∂, –∞ ${newJob.name}.`);
            } else {
                playSound('mcVillager'); showToast("–ù–∏–∫–æ–º—É —Ç—ã –Ω–∞—Ö—É–π –Ω–µ –Ω—É–∂–µ–Ω, –Ω–µ—É–¥–∞—á–Ω–∏–∫.", 'danger'); changeStat('stress', 10);
            }
            nextDay();
        }
        
        function relieveStress() {
            if (gameState.money < 1000) { showToast("–î–µ–Ω–µ–≥ –Ω–µ—Ç –¥–∞–∂–µ –Ω–∞ –±–æ—è—Ä—É!", "danger"); return; }
            playSound('gtaAhShit');
            changeStat('money', -1000); changeStat('stress', -40); changeStat('health', -5); haptic('medium');
            addEvent("–ü—Ä–æ—Å–∞–¥–∏–ª 1000 ‚ÇΩ –≤ –±–∞—Ä–µ. 'Ah shit, here we go again...'");
            nextDay();
        }
        
        function payDebt() {
            const payment = Math.min(gameState.money, 20000);
            if (payment <= 0) { showToast("–ù–µ—á–µ–º –ø–ª–∞—Ç–∏—Ç—å, —Ç—ã –Ω–∏—â–∏–π!", "danger"); return; }
            changeStat('money', -payment); changeStat('debt', -payment); changeStat('stress', -20);
            showToast(`–û—Ç–¥–∞–ª ${payment} ‚ÇΩ. –°–µ—Ä—ë–≥–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ –±—É–¥–µ—Ç –ª–æ–º–∞—Ç—å —Ç–µ–±–µ –Ω–æ–≥–∏.`, "success");
            nextDay();
        }

        function showModal(id) { document.getElementById(id).classList.add('show'); haptic('light');}
        function hideModal(id) { document.getElementById(id).classList.remove('show'); }

        function showFriendsModal() {
            const container = document.getElementById('friends-options'); container.innerHTML = '';
            gameState.friends.forEach(friend => {
                const el = document.createElement('div'); el.className = 'option'; let button;
                if (friend.debtAmount > 0) button = `<button class="repay" onclick="repayFriend('${friend.name}')">–í–µ—Ä–Ω—É—Ç—å ${friend.debtAmount} ‚ÇΩ</button>`;
                else button = `<button onclick="borrowFromFriend('${friend.name}')">–ó–∞–Ω—è—Ç—å ${friend.maxLoan} ‚ÇΩ</button>`;
                el.innerHTML = `<strong>${friend.name}</strong><br><small>${friend.desc}</small>${button}`; container.appendChild(el);
            });
            showModal('friends-modal');
        }
        
        function borrowFromFriend(name) {
            const friend = gameState.friends.find(f => f.name === name);
            if (Math.random() <= friend.chance) {
                changeStat('money', friend.maxLoan); friend.debtAmount = friend.maxLoan;
                showToast(`${friend.name} –æ–¥–æ–ª–∂–∏–ª ${friend.maxLoan} ‚ÇΩ. "–í–µ—Ä–Ω–∏, —Å—É–∫–∞, –∞ —Ç–æ —Ö—É–∂–µ –±—É–¥–µ—Ç"`, 'success');
            } else {
                changeStat('stress', 15);
                showToast(`${friend.name} ${phrases.friendReject[Math.floor(Math.random() * phrases.friendReject.length)]}`, 'danger');
            }
            hideModal('friends-modal'); nextDay();
        }

        function repayFriend(name) {
             const friend = gameState.friends.find(f => f.name === name);
             if (gameState.money < friend.debtAmount) { showToast("–ù–µ—Ç –±–∞–±–æ–∫, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –¥–æ–ª–≥!", "danger"); return; }
             changeStat('money', -friend.debtAmount);
             showToast(`–¢—ã –≤–µ—Ä–Ω—É–ª –¥–æ–ª–≥ ${friend.name}. –û–Ω —Å–Ω–æ–≤–∞ —Å—á–∏—Ç–∞–µ—Ç —Ç–µ–±—è —á–µ–ª–æ–≤–µ–∫–æ–º.`, 'success');
             friend.debtAmount = 0; hideModal('friends-modal'); nextDay();
        }

        function showFoodModal() {
            const container = document.getElementById('food-options'); container.innerHTML = '';
            food.forEach(item => {
                const el = document.createElement('div'); el.className = 'option';
                el.innerHTML = `<strong>${item.name}</strong> - ${item.cost} ‚ÇΩ<br><small>–°—ã—Ç–æ—Å—Ç—å: +${item.satiety}, –ó–¥–æ—Ä–æ–≤—å–µ: ${item.health > 0 ? '+':''}${item.health}</small>`;
                el.onclick = () => eat(item.name); container.appendChild(el);
            });
            showModal('food-modal');
        }

        function eat(name) {
            const foodItem = food.find(f => f.name === name);
            if (gameState.money < foodItem.cost) { showToast("–î–µ–Ω–µ–≥ –Ω–µ—Ç –¥–∞–∂–µ –Ω–∞ –µ–¥—É, –∏–¥–∏ —Ä–∞–±–æ—Ç–∞–π!", "danger"); return; }
            playSound('nom');
            changeStat('money', -foodItem.cost); changeStat('satiety', foodItem.satiety); changeStat('health', foodItem.health); changeStat('stress', foodItem.stress);
            addEvent(`–ü–æ–µ–ª: "${foodItem.name}". –•–æ—Ç—å –∫–∞–∫–∞—è-—Ç–æ —Ä–∞–¥–æ—Å—Ç—å –≤ —ç—Ç–æ–π –∂–∏–∑–Ω–∏.`);
            hideModal('food-modal'); nextDay();
        }
        
        function randomEvent() {
            const events = [
                () => { changeStat('money', 1000); showToast("–ù–∞—à—ë–ª 1000 ‚ÇΩ —É –ª–∞—Ä—å–∫–∞! –°–µ–≥–æ–¥–Ω—è –≤–µ–∑–µ—Ç.", 'success'); },
                () => { if(gameState.money > 1500) { changeStat('money', -1500); showToast("–¶—ã–≥–∞–Ω–µ —Ä–∞–∑–≤–µ–ª–∏ –Ω–∞ 1500 ‚ÇΩ. –õ–æ—Ö - —ç—Ç–æ —Å—É–¥—å–±–∞.", 'danger'); }},
                () => { changeStat('health', -15); showToast("–ü—Ä–æ—Å—Ç—É–¥–∏–ª—Å—è –ø–æ–¥ –¥–æ–∂–¥–µ–º, –∑–¥–æ—Ä–æ–≤—å–µ —É—Ö—É–¥—à–∏–ª–æ—Å—å.", 'warning'); },
            ];
            events[Math.floor(Math.random() * events.length)]();
        }
        
        function creditorHarassment() {
            const threat = phrases.debtThreats[Math.floor(Math.random() * phrases.debtThreats.length)];
            showToast(threat, 'danger'); playSound('vineBoom'); changeStat('stress', 30);
        }

        function checkGameOver() {
            if (gameState.health <= 0) endGame("üíÄ –°–î–û–•", phrases.gameOver.health);
            else if (gameState.stress >= 100) endGame("ü§Ø –ü–û–ï–•–ê–õ –ö–£–ö–£–•–û–ô", phrases.gameOver.stress);
            else if (gameState.day > 30 && gameState.debt > 70000) endGame("üî´ –†–ê–°–ü–†–ê–í–ê", phrases.gameOver.debt);
            else if (gameState.debt <= 0) endGame("üéâ –ü–û–ë–ï–î–ê, –ë–õ–Ø–¢–¨!", phrases.gameOver.win);
        }

        function endGame(title, text) {
            gameState.gameOver = true; saveGame(); playSound('gameOver'); haptic('error');
            document.getElementById('game-over-title').textContent = title; document.getElementById('game-over-text').textContent = text;
            showModal('game-over-modal');
        }
        
        function restartGame() {
            localStorage.removeItem('stepaGameState'); initGame(); hideModal('game-over-modal');
        }

        function saveGame() { localStorage.setItem('stepaGameState', JSON.stringify(gameState)); }
        function loadGame() {
            const savedState = localStorage.getItem('stepaGameState');
            if (savedState) {
                gameState = JSON.parse(savedState);
                if (gameState.gameOver) gameState = JSON.parse(JSON.stringify(initialGameState));
            } else { gameState = JSON.parse(JSON.stringify(initialGameState)); }
        }

        function initGame() {
            loadGame(); addEvent("–ü—Ä–æ—Å–Ω—É–ª—Å—è —Å –±–æ–¥—É–Ω–∞. –ö–∞–∂–µ—Ç—Å—è, —è –∫–æ–º—É-—Ç–æ –¥–æ–ª–∂–µ–Ω...", "warning"); updateUI();
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.body.addEventListener('click', initAudio, { once: true });
            document.querySelectorAll('.action-btn, .modal-close, .option').forEach(btn => {
                btn.addEventListener('click', (e) => { e.stopPropagation(); haptic('light'); playSound('click'); });
            });
            initGame();
        });
    </script>
</body>
</html>
