<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°—Ç–µ–ø–∞: –í—ã–∂–∏–≤–∞–Ω–∏–µ –≤ –ö—É—Ä—Å–∫–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --bg-start: #1a1a2e;
            --bg-end: #16213e;
            --primary: #e94560;
            --secondary: #0f3460;
            --text: #f0f0f0;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--text);
            min-height: 100vh;
            padding: 15px;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            background: var(--glass-bg);
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        h1 {
            font-size: 1.5rem;
            text-align: center;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary);
            margin-bottom: 15px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            font-size: 0.9rem;
            transition: transform 0.2s ease;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--text);
            transition: color 0.3s ease;
        }

        .progress-container {
            margin-top: 10px;
            font-size: 0.8rem;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        #stress-bar { background: linear-gradient(90deg, #ff9800, #f44336); }
        #health-bar { background: linear-gradient(90deg, #4caf50, #8bc34a); }
        #satiety-bar { background: linear-gradient(90deg, #ffc107, #ff9800); }
        
        .character-container {
            text-align: center;
            margin: 20px 0;
            font-size: 5rem;
            position: relative;
        }
        #stepa-emoji {
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
        #stepa-emoji:active {
            transform: scale(1.2) rotate(10deg);
        }

        .actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .action-btn {
            padding: 12px 5px;
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 85px;
        }
        .action-btn i {
            font-size: 1.5rem;
            color: var(--primary);
        }
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }
        .action-btn:active {
            transform: translateY(-1px) scale(0.98);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .events {
            background: var(--glass-bg);
            padding: 15px;
            border-radius: 20px;
            height: 150px;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
        }
        .event {
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--secondary);
            animation: slideIn 0.4s ease-out;
            font-size: 0.9rem;
        }
        .event.danger { border-left-color: var(--danger); }
        .event.success { border-left-color: var(--success); }
        .event.warning { border-left-color: var(--warning); }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none; /* Changed to none */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, var(--bg-end), var(--bg-start));
            padding: 25px;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }
        
        .modal-content h3 { color: var(--primary); margin-bottom: 15px; text-align: center; }
        .modal-close {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: background 0.2s ease;
        }
        .modal-close:hover { background: #d83a56; }
        
        .option {
            background: var(--glass-bg);
            padding: 15px;
            margin: 10px 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid var(--primary);
        }
        .option:hover { background: rgba(233, 69, 96, 0.2); transform: translateX(5px); }
        .option button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            margin-top: 10px;
            float: right;
        }
        .option button.repay { background-color: var(--success); }

        .game-over h2 { font-size: 2rem; }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–¢–æ—Å—Ç—ã) */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }
        .toast {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 12px;
            color: var(--text);
            font-size: 0.9rem;
            border-left: 5px solid var(--primary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.5s ease-out, fadeOut 0.5s ease-in 3.5s forwards;
        }
        .toast.success { border-left-color: var(--success); }
        .toast.danger { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
        
        .flash-green { animation: flash-green 0.7s ease; }
        @keyframes flash-green { 0%, 100% { color: var(--text); } 50% { color: var(--success); transform: scale(1.1); } }
        
        .flash-red { animation: flash-red 0.7s ease; }
        @keyframes flash-red { 0%, 100% { color: var(--text); } 50% { color: var(--danger); transform: scale(1.1); } }

        .shake { animation: shake 0.5s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div class="container">
        <div class="header">
            <h1>üê∑ –°–¢–ï–ü–ê: –í–´–ñ–ò–í–ê–ù–ò–ï –í –ö–£–†–°–ö–ï</h1>
            <div class="stats">
                <div class="stat-item">–î–µ–Ω—å<br><span class="stat-value" id="day">1</span></div>
                <div class="stat-item">–î–µ–Ω—å–≥–∏<br><span class="stat-value" id="money">5000 ‚ÇΩ</span></div>
                <div class="stat-item">–î–æ–ª–≥<br><span class="stat-value" id="debt">100 000 ‚ÇΩ</span></div>
                <div class="stat-item">–†–µ–ø—É—Ç–∞—Ü–∏—è<br><span class="stat-value" id="reputation">0</span></div>
            </div>
            <div class="progress-container">
                –ó–¥–æ—Ä–æ–≤—å–µ: <span id="health-value">100</span>/100
                <div class="progress-bar"><div class="progress-fill" id="health-bar" style="width: 100%"></div></div>
            </div>
            <div class="progress-container">
                –°—ã—Ç–æ—Å—Ç—å: <span id="satiety-value">100</span>/100
                <div class="progress-bar"><div class="progress-fill" id="satiety-bar" style="width: 100%"></div></div>
            </div>
            <div class="progress-container">
                –°—Ç—Ä–µ—Å—Å: <span id="stress-value">0</span>/100
                <div class="progress-bar"><div class="progress-fill" id="stress-bar" style="width: 0%"></div></div>
            </div>
        </div>
        
        <div class="character-container">
            <span id="stepa-emoji" onclick="animateStepa()">üò¥</span>
        </div>
        
        <div class="actions">
            <button class="action-btn" onclick="work()"><i class="fa-solid fa-person-digging"></i><span>–í–∫–∞–ª—ã–≤–∞—Ç—å</span></button>
            <button class="action-btn" onclick="showFoodModal()"><i class="fa-solid fa-burger"></i><span>–ü–æ–µ—Å—Ç—å</span></button>
            <button class="action-btn" onclick="showFriendsModal()"><i class="fa-solid fa-users"></i><span>–ö–µ–Ω—Ç—ã</span></button>
            <button class="action-btn" onclick="relieveStress()"><i class="fa-solid fa-beer-mug-empty"></i><span>–ß–∏–ª–∏—Ç—å</span></button>
            <button class="action-btn" onclick="payDebt()"><i class="fa-solid fa-hand-holding-dollar"></i><span>–û—Ç–¥–∞—Ç—å –¥–æ–ª–≥</span></button>
            <button class="action-btn" onclick="crime()"><i class="fa-solid fa-mask"></i><span>–ö—Ä–∏–º–∏–Ω–∞–ª</span></button>
        </div>
        
        <div class="events" id="events">
            <div class="event warning">üìû –î–µ–Ω—å 1: –ü—Ä–æ—Å–Ω—É–ª—Å—è. –°–µ—Ä—ë–≥–∞ –∑–≤–æ–Ω–∏—Ç: "–°—Ç–µ–ø–∞, –≥–¥–µ –º–æ–∏ 100–∫? –ú–µ—Å—è—Ü —Ç–µ–±–µ, –∏–ª–∏ –≤ –°–µ–π–º".</div>
        </div>
    </div>

    <div id="friends-modal" class="modal"><div class="modal-content"><h3>üë• –ö–µ–Ω—Ç—ã</h3><div id="friends-options"></div><button class="modal-close" onclick="hideModal('friends-modal')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
    <div id="food-modal" class="modal"><div class="modal-content"><h3>üçî –ü–æ–∂—Ä–∞—Ç—å</h3><div id="food-options"></div><button class="modal-close" onclick="hideModal('food-modal')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
    <div id="game-over-modal" class="modal"><div class="modal-content game-over"><h2 id="game-over-title">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2><p id="game-over-text"></p><button class="modal-close" onclick="restartGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button></div></div>

    <audio id="click-sound" src="https://www.myinstants.com/media/sounds/mouse-click.mp3" preload="auto"></audio>
    <audio id="money-gain" src="https://www.myinstants.com/media/sounds/cash-register-cha-ching.mp3" preload="auto"></audio>
    <audio id="money-loss" src="https://www.myinstants.com/media/sounds/bruh.mp3" preload="auto"></audio>
    <audio id="error-sound" src="https://www.myinstants.com/media/sounds/roblox-death-sound_1.mp3" preload="auto"></audio>
    <audio id="game-over-sound" src="https://www.myinstants.com/media/sounds/sad-violin.mp3" preload="auto"></audio>


    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
        let gameState = {
            day: 1,
            money: 5000,
            debt: 100000,
            health: 100,
            satiety: 100,
            stress: 0,
            reputation: 0,
            gameOver: false,
            friends: [
                { name: "–í–∞—Å—è–Ω", desc: "–°—Ç–∞—Ä—ã–π –¥—Ä—É–≥, –Ω–æ —Å–∞–º –≤ –∂–æ–ø–µ", maxLoan: 5000, chance: 0.6, debtAmount: 0 },
                { name: "–ü–µ—Ç—Ä—É—Ö–∞", desc: "–ñ–∞–¥–Ω—ã–π, —Å—á–∏—Ç–∞–µ—Ç –∫–∞–∂–¥—É—é –∫–æ–ø–µ–π–∫—É", maxLoan: 3000, chance: 0.3, debtAmount: 0 },
                { name: "–°–µ–º—ë–Ω—ã—á", desc: "–î—É—à–∞-–ø–∞—Ä–µ–Ω—å, –Ω–æ –ø–æ–¥ –∫–∞–±–ª—É–∫–æ–º", maxLoan: 7000, chance: 0.7, debtAmount: 0 },
                { name: "–ì—Ä–∏—à–∞ –ö–∞–±–∞–Ω", desc: "–ë—Ä–∞—Ç–æ–∫, –¥–∞—Å—Ç –ø–æ–¥ –ø—Ä–æ—Ü–µ–Ω—Ç", maxLoan: 10000, chance: 0.8, debtAmount: 0 }
            ],
            food: [
                { name: "–î–æ—à–∏—Ä–∞–∫", cost: 100, satiety: 20, health: -2, stress: 5 },
                { name: "–®–∞—É—Ä–º–∞ —É –ê—à–æ—Ç–∞", cost: 250, satiety: 40, health: 5, stress: 0 },
                { name: "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –æ–±–µ–¥", cost: 500, satiety: 60, health: 10, stress: -5 },
                { name: "–°—Ö–æ–¥–∏—Ç—å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω", cost: 2000, satiety: 100, health: 15, stress: -20 }
            ]
        };

        // --- –≠–ª–µ–º–µ–Ω—Ç—ã UI ---
        const ui = {
            day: document.getElementById('day'),
            money: document.getElementById('money'),
            debt: document.getElementById('debt'),
            reputation: document.getElementById('reputation'),
            health: document.getElementById('health-value'),
            healthBar: document.getElementById('health-bar'),
            satiety: document.getElementById('satiety-value'),
            satietyBar: document.getElementById('satiety-bar'),
            stress: document.getElementById('stress-value'),
            stressBar: document.getElementById('stress-bar'),
            stepaEmoji: document.getElementById('stepa-emoji'),
            events: document.getElementById('events'),
            toastContainer: document.getElementById('toast-container')
        };
        
        // --- –ó–≤—É–∫–∏ ---
        const sounds = {
            click: document.getElementById('click-sound'),
            gain: document.getElementById('money-gain'),
            loss: document.getElementById('money-loss'),
            error: document.getElementById('error-sound'),
            gameOver: document.getElementById('game-over-sound'),
        };
        function playSound(sound) {
            sound.currentTime = 0;
            sound.volume = 0.5;
            sound.play().catch(e => console.log("–ó–≤—É–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º"));
        }
        document.body.addEventListener('click', () => playSound(sounds.click), { once: true });

        // --- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
        function updateUI() {
            updateStat('day', gameState.day);
            updateStat('money', gameState.money.toLocaleString('ru-RU') + ' ‚ÇΩ');
            updateStat('debt', gameState.debt.toLocaleString('ru-RU') + ' ‚ÇΩ');
            updateStat('reputation', gameState.reputation);
            
            ui.health.textContent = gameState.health;
            ui.healthBar.style.width = `${gameState.health}%`;
            ui.satiety.textContent = gameState.satiety;
            ui.satietyBar.style.width = `${gameState.satiety}%`;
            ui.stress.textContent = gameState.stress;
            ui.stressBar.style.width = `${gameState.stress}%`;
            
            updateStepaEmoji();
        }
        
        function updateStat(key, value, change = 0) {
            const el = ui[key];
            if (el) {
                el.textContent = value;
                if (change > 0) el.classList.add('flash-green');
                if (change < 0) el.classList.add('flash-red');
                setTimeout(() => {
                    el.classList.remove('flash-green', 'flash-red');
                }, 700);
            }
        }
        
        function changeStat(stat, value) {
            const oldValue = gameState[stat];
            gameState[stat] = Math.max(0, gameState[stat] + value);
            if (stat === 'stress' || stat === 'health' || stat === 'satiety') {
                gameState[stat] = Math.min(100, gameState[stat]);
            }
            const change = gameState[stat] - oldValue;
            updateUI(); // –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
            // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
            const el = ui[stat] || document.getElementById(`${stat}-value`);
            if (el) {
                 if (change > 0) el.parentElement.querySelector('.stat-value')?.classList.add('flash-green');
                 if (change < 0) el.parentElement.querySelector('.stat-value')?.classList.add('flash-red');
                 setTimeout(() => {
                     el.parentElement.querySelector('.stat-value')?.classList.remove('flash-green', 'flash-red');
                 }, 700);
            }
        }

        function updateStepaEmoji() {
            if (gameState.health <= 20) ui.stepaEmoji.textContent = 'üíÄ';
            else if (gameState.satiety <= 20) ui.stepaEmoji.textContent = 'ü§¢';
            else if (gameState.stress >= 80) ui.stepaEmoji.textContent = 'üò°';
            else if (gameState.money < 1000) ui.stepaEmoji.textContent = 'üò≠';
            else if (gameState.debt > gameState.money * 10) ui.stepaEmoji.textContent = 'üò±';
            else ui.stepaEmoji.textContent = 'üòê';
        }
        
        function animateStepa(type = 'shake') {
            ui.stepaEmoji.classList.add(type);
            setTimeout(() => ui.stepaEmoji.classList.remove(type), 500);
        }

        function addEvent(message, type = "default") {
            const eventEl = document.createElement('div');
            eventEl.className = `event ${type}`;
            eventEl.innerHTML = `<i class="fa-solid fa-circle-info"></i> ${message}`;
            ui.events.prepend(eventEl);
        }

        function showToast(message, type = "default") {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            ui.toastContainer.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        function nextDay() {
            if (gameState.gameOver) return;
            changeStat('day', 1);
            
            // –†–∞—Å—Ö–æ–¥ —Å—ã—Ç–æ—Å—Ç–∏ –∏ –∑–¥–æ—Ä–æ–≤—å—è
            changeStat('satiety', -10);
            if (gameState.satiety <= 0) {
                changeStat('health', -10);
                showToast("–ñ–µ–ª—É–¥–æ–∫ —Å–≤–æ–¥–∏—Ç –æ—Ç –≥–æ–ª–æ–¥–∞. –ó–¥–æ—Ä–æ–≤—å–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è!", "danger");
            }
            // –ü–∞—Å—Å–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–∞
            if(gameState.stress > 0) changeStat('stress', -2);

            // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            if (Math.random() < 0.25) randomEvent();

            checkGameOver();
            updateUI();
        }

        // --- –î–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞ ---
        function work() {
            const earnings = Math.floor(Math.random() * 1500) + 500;
            const stress = 10;
            const health = -5;
            const satiety = -15;

            changeStat('money', earnings);
            changeStat('stress', stress);
            changeStat('health', health);
            changeStat('satiety', satiety);

            playSound(sounds.gain);
            showToast(`–¢—ã –≤–ø–∞—Ö–∏–≤–∞–ª –∫–∞–∫ –∫–æ–Ω—å –∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª ${earnings} ‚ÇΩ`, 'success');
            addEvent(`–ó–∞—Ä–∞–±–æ—Ç–∞–ª ${earnings} ‚ÇΩ, –Ω–æ —É—Å—Ç–∞–ª –∫–∞–∫ —Å–æ–±–∞–∫–∞.`);
            nextDay();
        }
        
        function relieveStress() {
            if (gameState.money < 1000) {
                playSound(sounds.error);
                showToast("–î–µ–Ω–µ–≥ –Ω–µ—Ç –¥–∞–∂–µ –Ω–∞ –ø–∏–≤–æ!", "danger");
                return;
            }
            changeStat('money', -1000);
            changeStat('stress', -40);
            changeStat('health', -5);
            playSound(sounds.loss);
            showToast("–ó–∞–ª–∏–ª –≥–ª–∞–∑–∞, —Å—Ç—Ä–µ—Å—Å –Ω–µ–º–Ω–æ–≥–æ —É—à–µ–ª", "success");
            addEvent("–ü—Ä–æ—Å–∞–¥–∏–ª 1000 ‚ÇΩ –≤ –±–∞—Ä–µ. –°—Ç–∞–ª–æ –ª–µ–≥—á–µ, –Ω–æ –Ω–µ —Å–∏–ª—å–Ω–æ.");
            nextDay();
        }

        function payDebt() {
            const payment = Math.min(gameState.money, 20000);
            if (payment <= 0) {
                playSound(sounds.error);
                showToast("–ù–µ—á–µ–º –ø–ª–∞—Ç–∏—Ç—å, —Ç—ã –±–∞–Ω–∫—Ä–æ—Ç!", "danger");
                return;
            }
            changeStat('money', -payment);
            changeStat('debt', -payment);
            changeStat('stress', -20);
            changeStat('reputation', 5);
            playSound(sounds.gain);
            showToast(`–û—Ç–¥–∞–ª ${payment} ‚ÇΩ. –°–µ—Ä—ë–≥–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ –∑–≤–æ–Ω–∏—Ç.`, "success");
            addEvent(`–ü–æ–≥–∞—Å–∏–ª —á–∞—Å—Ç—å –¥–æ–ª–≥–∞ (${payment} ‚ÇΩ).`);
            nextDay();
        }
        
        function crime() {
            showToast("–ö—Ä–∏–º–∏–Ω–∞–ª - –æ–ø–∞—Å–Ω–∞—è —Ç–µ–º–∞...", "warning");
            animateStepa();
            if (Math.random() > 0.5) {
                const earnings = Math.floor(Math.random() * 10000) + 2000;
                changeStat('money', earnings);
                changeStat('stress', 20);
                changeStat('reputation', -10);
                playSound(sounds.gain);
                showToast(`–£–¥–∞—á–Ω–æ –≥–æ–ø-—Å—Ç–æ–ø–Ω—É–ª –º–∞–∂–æ—Ä–∞. +${earnings} ‚ÇΩ`, 'success');
            } else {
                const healthLoss = -25;
                changeStat('health', healthLoss);
                changeStat('stress', 30);
                playSound(sounds.error);
                showToast(`–¢–µ–±—è –ø–æ–π–º–∞–ª–∏ –∏ –æ—Ç–ø–∏–∑–¥–∏–ª–∏. –ó–¥–æ—Ä–æ–≤—å–µ ${healthLoss}`, 'danger');
            }
            nextDay();
        }

        // --- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ ---
        function showModal(id) { document.getElementById(id).classList.add('show'); }
        function hideModal(id) { document.getElementById(id).classList.remove('show'); }

        function showFriendsModal() {
            const container = document.getElementById('friends-options');
            container.innerHTML = '';
            gameState.friends.forEach(friend => {
                const el = document.createElement('div');
                el.className = 'option';
                let button;
                if (friend.debtAmount > 0) {
                    button = `<button class="repay" onclick="repayFriend('${friend.name}')">–í–µ—Ä–Ω—É—Ç—å ${friend.debtAmount} ‚ÇΩ</button>`;
                } else {
                    button = `<button onclick="borrowFromFriend('${friend.name}')">–ó–∞–Ω—è—Ç—å ${friend.maxLoan} ‚ÇΩ</button>`;
                }
                el.innerHTML = `<strong>${friend.name}</strong><br><small>${friend.desc}</small>${button}`;
                container.appendChild(el);
            });
            showModal('friends-modal');
        }
        
        function borrowFromFriend(name) {
            const friend = gameState.friends.find(f => f.name === name);
            if (Math.random() <= friend.chance + (gameState.reputation / 100)) {
                changeStat('money', friend.maxLoan);
                friend.debtAmount = friend.maxLoan;
                playSound(sounds.gain);
                showToast(`${friend.name} –æ–¥–æ–ª–∂–∏–ª ${friend.maxLoan} ‚ÇΩ. "–í–µ—Ä–Ω–∏, –∏–Ω–∞—á–µ —Ö—É–∂–µ –±—É–¥–µ—Ç"`, 'success');
            } else {
                changeStat('stress', 15);
                changeStat('reputation', -5);
                playSound(sounds.error);
                showToast(`${friend.name} –ø–æ—Å–ª–∞–ª —Ç–µ–±—è –Ω–∞—Ö–µ—Ä.`, 'danger');
            }
            hideModal('friends-modal');
            nextDay();
        }

        function repayFriend(name) {
             const friend = gameState.friends.find(f => f.name === name);
             if (gameState.money < friend.debtAmount) {
                 showToast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –¥–æ–ª–≥!", "danger");
                 playSound(sounds.error);
                 return;
             }
             changeStat('money', -friend.debtAmount);
             changeStat('reputation', 10);
             showToast(`–¢—ã –≤–µ—Ä–Ω—É–ª –¥–æ–ª–≥ ${friend.name}. –û–Ω —Å–Ω–æ–≤–∞ —Ç–µ–±–µ –¥–æ–≤–µ—Ä—è–µ—Ç.`, 'success');
             friend.debtAmount = 0;
             hideModal('friends-modal');
             nextDay();
        }

        function showFoodModal() {
            const container = document.getElementById('food-options');
            container.innerHTML = '';
            gameState.food.forEach(item => {
                const el = document.createElement('div');
                el.className = 'option';
                el.innerHTML = `<strong>${item.name}</strong> - ${item.cost} ‚ÇΩ<br><small>–°—ã—Ç–æ—Å—Ç—å: +${item.satiety}, –ó–¥–æ—Ä–æ–≤—å–µ: ${item.health > 0 ? '+':''}${item.health}</small>`;
                el.onclick = () => eat(item.name);
                container.appendChild(el);
            });
            showModal('food-modal');
        }

        function eat(name) {
            const food = gameState.food.find(f => f.name === name);
            if (gameState.money < food.cost) {
                playSound(sounds.error);
                showToast("–ù–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –µ–¥—É!", "danger");
                return;
            }
            changeStat('money', -food.cost);
            changeStat('satiety', food.satiety);
            changeStat('health', food.health);
            changeStat('stress', food.stress);
            playSound(food.cost > 500 ? sounds.gain : sounds.loss);
            showToast(`–¢—ã –ø–æ–µ–ª: "${food.name}". –°—Ç–∞–ª–æ –ø–æ–ª—É—á—à–µ.`, 'success');
            hideModal('food-modal');
            nextDay();
        }

        // --- –°–æ–±—ã—Ç–∏—è –∏ –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã ---
        function randomEvent() {
            const events = [
                () => { changeStat('money', 1000); showToast("–ù–∞—à—ë–ª 1000 ‚ÇΩ –Ω–∞ –¥–æ—Ä–æ–≥–µ!", 'success'); },
                () => { changeStat('money', -1500); showToast("–ü–æ—Ç–µ—Ä—è–ª –∫–æ—à–µ–ª—ë–∫. -1500 ‚ÇΩ.", 'danger'); playSound(sounds.loss); },
                () => { changeStat('health', -15); showToast("–ü—Ä–æ—Å—Ç—É–¥–∏–ª—Å—è –ø–æ–¥ –¥–æ–∂–¥–µ–º, –∑–¥–æ—Ä–æ–≤—å–µ —É—Ö—É–¥—à–∏–ª–æ—Å—å.", 'warning'); },
                () => { if (gameState.debt > 0) { changeStat('stress', 25); showToast("–ó–≤–æ–Ω–∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä—ã, —É–≥—Ä–æ–∂–∞–ª–∏ —Å–ª–æ–º–∞—Ç—å –Ω–æ–≥–∏.", 'danger'); animateStepa(); } },
            ];
            events[Math.floor(Math.random() * events.length)]();
        }

        function checkGameOver() {
            if (gameState.health <= 0) endGame("üíÄ –°–ú–ï–†–¢–¨ –û–¢ –ë–û–õ–ï–ó–ù–ï–ô", "–¢—ã –Ω–µ —Å–ª–µ–¥–∏–ª –∑–∞ –∑–¥–æ—Ä–æ–≤—å–µ–º –∏ –æ—Ç–∫–∏–Ω—É–ª—Å—è. –î–æ–ª–≥–∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤–∏—Å–µ—Ç—å –Ω–∞ –º–∞–º–∫–µ.");
            else if (gameState.stress >= 100) endGame("ü§Ø –°–ú–ï–†–¢–¨ –û–¢ –°–¢–†–ï–°–°–ê", "–¢–≤–æ–∏ –Ω–µ—Ä–≤—ã –Ω–µ –≤—ã–¥–µ—Ä–∂–∞–ª–∏. –ò–Ω—Å—É–ª—å—Ç. –ö–æ–Ω–µ—Ü.");
            else if (gameState.day > 30 && gameState.debt > 50000) endGame("üî´ –†–ê–°–ü–†–ê–í–ê", "–¢–µ—Ä–ø–µ–Ω–∏–µ –°–µ—Ä—ë–≥–∏ –ª–æ–ø–Ω—É–ª–æ. –¢–µ–±—è –Ω–∞—à–ª–∏ –≤ –ª–µ—Å—É. –ë–µ–∑ –≥–æ–ª–æ–≤—ã.");
            else if (gameState.debt <= 0) endGame("üéâ –ü–û–ë–ï–î–ê!", "–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–æ —Ç—ã –æ—Ç–¥–∞–ª –≤—Å–µ –¥–æ–ª–≥–∏! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∂–∏–∑–Ω—å... –∏–ª–∏ –≤–∑—è—Ç—å –Ω–æ–≤—ã–π –∫—Ä–µ–¥–∏—Ç.");
        }

        function endGame(title, text) {
            gameState.gameOver = true;
            playSound(sounds.gameOver);
            document.getElementById('game-over-title').textContent = title;
            document.getElementById('game-over-text').textContent = text;
            showModal('game-over-modal');
        }
        
        function restartGame() { location.reload(); }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.addEventListener('click', () => playSound(sounds.click));
            });
            updateUI();
        });
    </script>
</body>
</html>

